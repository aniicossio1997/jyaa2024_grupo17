<p-button
  pRipple
  label="Volver"
  icon="pi pi-arrow-left"
  styleClass="mb-2"
  (click)="back()"
  severity="secondary"
/>
<div *ngIf="!!elaboracionDetalle" class="card relative">
  <div class="mt-2">
    <div class="mb-4 font-bold">Detalle de elaboración</div>
    <div class="mb-4 text-lg">
      Receta: <b>{{ elaboracionDetalle.receta.nombre }}</b>
    </div>
    <div class="grid text-lg">
      <div class="col-6">
        Código: <b>{{ elaboracionDetalle.codigo }}</b>
      </div>
      <div class="col-6">
        Autor: <b>{{ autor }}</b>
      </div>
      <div class="col-6">
        Estado:
        <p-tag
          class="ml-1"
          [value]="elaboracionDetalle.estado.estado"
          [severity]="getEstadoSeverity(elaboracionDetalle.estado.estado)"
        />
      </div>
      <div class="col-6">
        Cantidad: <b>{{ elaboracionDetalle.cantidad }}</b>
      </div>
      <div class="col-6">
        Actualizado:
        <b>{{ elaboracionDetalle.estado.fecha | dateTransformPipe }}</b>
      </div>
    </div>
  </div>

  <div>
    <p-divider />

    <div>
      <p-table
        #dt2
        [value]="elaboracionDetalle.notas"
        [tableStyle]="{ 'min-width': '50rem' }"
        [paginator]="true"
        [alwaysShowPaginator]="false"
        [rows]="5"
        [tableStyle]="{ 'min-width': '50rem' }"
        [rowsPerPageOptions]="[5, 10, 20]"
        [globalFilterFields]="['autor.username', 'fecha', 'descripcion']"
      >
        <ng-template pTemplate="caption">
          <div class="flex align-items-center justify-content-between">
            <h5 class="m-0">Notas</h5>
            <p-button
              pRipple
              label="Agregar Nota"
              icon="pi pi-plus"
              styleClass="mb-2"
              (click)="back()"
              severity="primary"
            />
          </div>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="fecha">Fecha<p-sortIcon field="fecha" /></th>
            <th pSortableColumn="autor.username">
              Autor <p-sortIcon field="autor.username" />
            </th>
            <th pSortableColumn="descripcion">
              Nota <p-sortIcon field="descripcion" />
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
          <tr>
            <td>
              {{ item.fecha | dateTransformPipe }}
            </td>
            <td>{{ item.autor.username }}</td>

            <td>
              {{ item.descripcion }}
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td class="text-center py-4" [attr.colspan]="6">
              No se encontraron resultados
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
    <div class="mt-3">
      <p-table
        #dt
        [value]="elaboracionDetalle.estados"
        [tableStyle]="{ 'min-width': '50rem' }"
        [paginator]="true"
        [rows]="5"
        [tableStyle]="{ 'min-width': '50rem' }"
        [alwaysShowPaginator]="false"
        [rowsPerPageOptions]="[5, 10, 20]"
        [globalFilterFields]="['estado', 'fecha', 'autor.username']"
      >
        <ng-template pTemplate="caption">
          <h5 >Historial de Estados</h5>

          <div class="flex align-items-center justify-content-between">
            <span class="p-input-icon-left">
              <i class="pi pi-search"></i>
              <input
                pInputText
                type="text"
                (input)="dt.filterGlobal($event.target.value, 'contains')"
                placeholder="Buscar..."
              />
            </span>
            <p-button
              pRipple
              label="Cambiar estado"
              icon="pi pi-tag"
              styleClass="mb-2"
              (click)="back()"
              severity="primary"
            />
          </div>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="fecha">
              Fecha Inicio<p-sortIcon field="fecha" />
            </th>
            <th pSortableColumn="autor.username">
              Autor <p-sortIcon field="autor.username" />
            </th>
            <th pSortableColumn="estado">
              Estado <p-sortIcon field="estado" />
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item>
          <tr>
            <td>
              {{ item.fecha | dateTransformPipe }}
            </td>
            <td>{{ item.autor.username }}</td>

            <td>
              <p-tag
                [value]="item.estado"
                [severity]="getEstadoSeverity(item.estado)"
              />
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td class="text-center py-4" [attr.colspan]="6">
              No se encontraron resultados
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>


  </div>
</div>
