import{a as G}from"./chunk-VBIBN2AT.js";import{a as C,b as pt,c as Z,d as ct}from"./chunk-2HMGA3HY.js";import{a as Je,b as Ke}from"./chunk-5FI5EUAA.js";import{a as j}from"./chunk-CL7TEWH3.js";import{a as be,b as dt}from"./chunk-74WSQMHU.js";import{a as ue,b as Ye}from"./chunk-UHWMFGLO.js";import{a as ce,b as Xe}from"./chunk-676UXHSL.js";import{a as Be}from"./chunk-LHQOYPNM.js";import{B as st,i as fe,j as et,l as ve,m as tt,n as _e,o as ge,p as he,q as it,s as nt,t as rt,u as ot,v as at,w as mt,z as lt}from"./chunk-N32QBCDO.js";import{a as qe,b as We,e as de,f as pe,g as ze,i as Ze,l as Ue}from"./chunk-MOHWG4PF.js";import{$ as f,G as Ge,H as R,I as Oe,K as ee,L as P,N as te,O as ie,P as ne,R as M,T as re,U as oe,V as ae,W as me,X as W,Z as Le,_ as $e,ca as le,ea as A,fa as se,ha as Qe,ja as V,m as ke,pa as k,q as je,qa as He,v as N}from"./chunk-VXQCQYAP.js";import{$ as F,$b as J,Db as $,Eb as Q,Fb as B,Gb as L,Hb as m,Ib as b,Ic as Re,Jb as E,Kb as U,Kc as K,Lc as X,Oa as a,Pa as v,Pb as T,Pc as Y,Rb as h,Rc as Ae,S as Te,Sb as q,Uc as Ve,_b as H,aa as Ne,eb as y,fb as z,gb as d,ia as S,ja as I,jb as O,pb as t,qb as n,rb as p,vb as w,xb as g,yb as _}from"./chunk-MPDHWXUF.js";var ut=()=>({"min-width":"50rem"}),Ct=()=>[5,10,20],wt=()=>["nombre"],Et=r=>[r];function Mt(r,s){if(r&1){let l=w();t(0,"h2",9),m(1,"Recetas"),n(),t(2,"div",10)(3,"div",11)(4,"span",12),p(5,"i",13),t(6,"input",14),g("input",function(e){S(l),_();let o=L(2);return I(o.filterGlobal(e.target.value,"contains"))}),n()()(),p(7,"p-button",15),n()}if(r&2){let l=_();a(7),d("routerLink",q(1,Et,l.Routes.NEW))}}function Pt(r,s){r&1&&(t(0,"tr")(1,"th"),m(2,"Acciones"),n(),t(3,"th",16),m(4,"Nombre "),p(5,"p-sortIcon",17),n(),t(6,"th",18),m(7," Descripci\xF3n "),p(8,"p-sortIcon",19),n(),t(9,"th",20),m(10,"Autor "),p(11,"p-sortIcon",21),n(),t(12,"th",22),m(13," Cant. Elaboraciones "),p(14,"p-sortIcon",23),n(),t(15,"th",24),m(16," Cant. Ingredientes "),p(17,"p-sortIcon",25),n()())}function Dt(r,s){if(r&1){let l=w();t(0,"tr")(1,"td")(2,"button",26),g("click",function(e){let o=S(l).$implicit,c=L(4),x=_();return I(x.generateMenu(o,c,e))}),n(),p(3,"p-menu",27,1),n(),t(5,"td"),m(6),n(),t(7,"td"),m(8),n(),t(9,"td"),m(10),n(),t(11,"td"),m(12),n(),t(13,"td"),m(14),n()()}if(r&2){let l=s.$implicit,i=_();a(3),d("popup",!0)("model",i.itemsMenu),a(3),b(l.nombre),a(2),b(l.descripcion),a(2),b(l.autor),a(2),b(l.elaboraciones),a(2),b(l.ingredientes)}}function Ft(r,s){r&1&&(t(0,"tr")(1,"td",28),m(2," No se encontraron resultados "),n()()),r&2&&(a(),z("colspan",6))}function Tt(r,s){if(r&1&&(t(0,"div",29),m(1),n()),r&2){let l=_(),i=L(2);a(),E(" En total hay ",i.filteredValue?i.filteredValue.length:l.recetas.length," registros. ")}}var ft=(()=>{let s=class s{constructor(i,e,o,c){this.recetasService=i,this.router=e,this.toastr=o,this.confirmationDialogService=c,this.recetas=[],this.loading=!0,this.itemsMenu=[]}ngOnInit(){this.fetchAll()}fetchAll(){this.loading=!0,this.recetasService.get().subscribe(i=>{this.recetas=i,this.loading=!1})}get Routes(){return{NEW:`/${f.Receta}/${f.New}`}}generateMenu(i,e,o){e.toggle(o),this.itemsMenu=[{label:"Detalle",icon:"pi pi-eye",command:()=>{this.router.navigate([`/${f.Receta}/${f.Detail}/`,i.id])}},{label:"Editar",icon:"pi pi-pencil",command:()=>{this.router.navigate([`/${f.Receta}/${f.Edit}/`,i.id])}},{label:"Eliminar",icon:"pi pi-trash",command:()=>{this.delete(i)}}]}delete(i){this.confirmationDialogService.confirmDelete("\xBFEst\xE1 seguro que desea eliminar la receta?",()=>{this.recetasService.delete(i.id).subscribe(()=>{this.toastr.success("Se ha eliminado la receta"),this.fetchAll()})})}};s.\u0275fac=function(e){return new(e||s)(v(C),v(A),v(V),v(Be))},s.\u0275cmp=F({type:s,selectors:[["app-query"]],features:[T([C,ke,je])],decls:8,vars:11,consts:[["dt",""],["menu",""],[1,"card"],[3,"value","tableStyle","paginator","rows","rowsPerPageOptions","globalFilterFields"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[1,"mb-4"],[1,"flex","align-items-center","justify-content-between","flex-wrap"],[1,"flex","gap-4","flex-wrap"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Buscar...",3,"input"],["pRipple","","severity","primary","label","Agregar Receta","icon","pi pi-plus",1,"mr-2",3,"routerLink"],["pSortableColumn","nombre"],["field","nombre"],["pSortableColumn","descripcion"],["field","descripcion"],["pSortableColumn","autor"],["field","autor"],["pSortableColumn","elaboraciones"],["field","elaboraciones"],["pSortableColumn","ingredientes"],["field","ingredientes"],["pButton","","pRipple","","type","button","icon","pi pi-bars",1,"p-button-rounded","p-button-text",3,"click"],["appendTo","body",3,"popup","model"],[1,"text-center","py-4"],[1,"flex","align-items-center","justify-content-between"]],template:function(e,o){e&1&&(t(0,"div",2)(1,"p-table",3,0),y(3,Mt,8,3,"ng-template",4)(4,Pt,18,0,"ng-template",5)(5,Dt,15,7,"ng-template",6)(6,Ft,3,1,"ng-template",7)(7,Tt,2,1,"ng-template",8),n()()),e&2&&(a(),d("value",o.recetas)("tableStyle",h(7,ut))("paginator",!0)("rows",5)("tableStyle",h(8,ut))("rowsPerPageOptions",h(9,Ct))("globalFilterFields",h(10,wt)))},dependencies:[se,_e,N,ge,he,Ge,R,qe,k],encapsulation:2});let r=s;return r})();var Pe=r=>[r],_t=()=>({"min-width":"50rem"}),Nt=()=>[5,10,20],Rt=()=>["nombre","cantidad","cantidadDisponible","tipo"],At=()=>["cantidad","estado.estado","codigo","fecha"];function Vt(r,s){if(r&1){let l=w();t(0,"h4"),m(1,"Ingredientes"),n(),t(2,"div",19)(3,"div",20)(4,"span",21),p(5,"i",22),t(6,"input",23),g("input",function(e){S(l),_();let o=L(16);return I(o.filterGlobal(e.target.value,"contains"))}),n()()()()}}function kt(r,s){r&1&&(t(0,"tr")(1,"th",24),m(2," Ingrediente "),p(3,"p-sortIcon",25),n(),t(4,"th",26),m(5,"Tipo "),p(6,"p-sortIcon",27),n(),t(7,"th",28),m(8," Cantidad "),p(9,"p-sortIcon",29),n(),t(10,"th",30),m(11," Disponible "),p(12,"p-sortIcon",31),n()())}function jt(r,s){if(r&1&&(t(0,"tr")(1,"td"),m(2),n(),t(3,"td"),m(4),n(),t(5,"td"),m(6),n(),t(7,"td",32)(8,"b"),m(9),n()()()),r&2){let l=s.$implicit;a(2),E(" ",l.nombre," "),a(2),E(" ",l.tipo," "),a(2),U("",l.cantidad," ",l.unidadMedida,""),a(),d("ngClass",l.cantidadDisponible>=l.cantidad?"text-green-400":"text-red-400"),a(2),U("",l.cantidadDisponible," ",l.unidadMedida,"")}}function Gt(r,s){r&1&&(t(0,"tr")(1,"td",33),m(2," No se encontraron resultados "),n()()),r&2&&(a(),z("colspan",6))}function Ot(r,s){if(r&1&&(t(0,"div",6)(1,"div",7)(2,"h1",8),m(3),H(4,"titlecase"),n()(),t(5,"span",9),p(6,"p-button",10),n(),t(7,"p",11),m(8),n(),t(9,"div",12)(10,"div",13)(11,"b"),m(12,"Autor:"),n(),m(13),n()(),t(14,"div")(15,"p-table",14,0),y(17,Vt,7,0,"ng-template",15)(18,kt,13,0,"ng-template",16)(19,jt,10,7,"ng-template",17)(20,Gt,3,1,"ng-template",18),n()()()),r&2){let l=_();a(3),b(J(4,13,l.receta.nombre)),a(3),d("text",!0)("routerLink",q(15,Pe,l.Routes.EDIT)),a(2),b(l.receta.descripcion),a(5),U(" ",l.receta.autor.nombre," ",l.receta.autor.apellido," "),a(2),d("value",l.ingredientesNormal)("tableStyle",h(17,_t))("paginator",!0)("rows",10)("rowsPerPageOptions",h(18,Nt))("globalFilterFields",h(19,Rt))("alwaysShowPaginator",!1)}}function Lt(r,s){if(r&1){let l=w();t(0,"h4"),m(1,"Elaboraciones"),n(),t(2,"div",19)(3,"div",20)(4,"span",21),p(5,"i",22),t(6,"input",23),g("input",function(e){S(l),_();let o=L(3);return I(o.filterGlobal(e.target.value,"contains"))}),n()()(),p(7,"p-button",4),n()}if(r&2){let l=_(2);a(7),d("routerLink",q(1,Pe,l.Routes.ELABORACION_NEW))}}function $t(r,s){r&1&&(t(0,"tr")(1,"th",35),m(2," Fecha Inicio"),p(3,"p-sortIcon",36),n(),t(4,"th",28),m(5," Cantidad "),p(6,"p-sortIcon",27),n(),t(7,"th",37),m(8,"Codigo "),p(9,"p-sortIcon",38),n(),t(10,"th",39),m(11,"Estado "),p(12,"p-sortIcon",40),n(),t(13,"th",41),m(14," Actualizado"),p(15,"p-sortIcon",42),n()())}function Qt(r,s){if(r&1&&(t(0,"tr")(1,"td"),m(2),H(3,"dateTransformPipe"),n(),t(4,"td"),m(5),n(),t(6,"td")(7,"b"),m(8),n()(),t(9,"td"),p(10,"p-tag",43),n(),t(11,"td"),m(12),H(13,"dateTransformPipe"),n()()),r&2){let l=s.$implicit,i=_(2);a(2),E(" ",J(3,6,l.fecha)," "),a(3),E(" ",l.cantidad," "),a(3),b(l.codigo),a(2),d("value",l.estado.estado)("severity",i.getEstadoSeverity(l.estado.estado)),a(2),E(" ",J(13,8,l.estado.fecha)," ")}}function Bt(r,s){r&1&&(t(0,"tr")(1,"td",33),m(2," No se encontraron resultados "),n()()),r&2&&(a(),z("colspan",6))}function qt(r,s){if(r&1&&(t(0,"div",6)(1,"div")(2,"p-table",34,1),y(4,Lt,8,3,"ng-template",15)(5,$t,16,0,"ng-template",16)(6,Qt,14,10,"ng-template",17)(7,Bt,3,1,"ng-template",18),n()()()),r&2){let l=_();a(2),d("value",l.receta.elaboraciones)("tableStyle",h(6,_t))("paginator",!0)("rows",5)("globalFilterFields",h(7,At))("alwaysShowPaginator",!1)}}var gt=(()=>{let s=class s{constructor(i,e,o,c){this.recetasService=i,this.router=e,this.toastr=o,this.activatedRoute=c,this.loading=!1,this.id=Number(this.activatedRoute.snapshot.paramMap.get("id"))}ngOnInit(){this.recetasService.detail(this.id).subscribe(i=>{this.receta=i,this.ingredientesNormal=this.receta.ingredientes.map(e=>({cantidad:e.cantidad,nombre:e.insumo?.nombre||e.materiaPrima?.nombre,unidadMedida:e.materiaPrima?.unidadMedida||e.insumo?.unidadMedida,tipo:e.insumo?"INSUMO":"MATERIA PRIMA",cantidadDisponible:e.insumo?.cantidadDisponible||e.materiaPrima?.totalCantidadDisponible||0}))})}getEstadoSeverity(i){switch(i){case Z.ENTREGADO_COMPLETO:return"success";case Z.ENTREGADO_PARCIAL:return"primary";case Z.EN_DEPOSITO:return"warning";case Z.EN_PROCESO:return"info"}return""}get Routes(){return{EDIT:`/${f.Receta}/${f.Edit}/${this.receta?.id}`,ELABORACION_NEW:`/${f.Elaboracion}/${f.New}/${this.receta?.id}`}}back(){this.router.navigate(["/"+f.Receta,f.Query])}};s.\u0275fac=function(e){return new(e||s)(v(C),v(A),v(V),v(le))},s.\u0275cmp=F({type:s,selectors:[["receta-detail"]],features:[T([C])],decls:5,vars:5,consts:[["dt",""],["dt2",""],[1,"flex","justify-content-between"],["pRipple","","label","Volver","icon","pi pi-arrow-left","styleClass","mb-2","severity","secondary",3,"click"],["pRipple","","severity","primary","label","Gestionar Elaboraciones","icon","fa-solid fa-jar",3,"routerLink"],["class","card relative",4,"ngIf"],[1,"card","relative"],[1,"font-bold","mt-2"],[1,"p-card-title"],[1,"absolute",2,"top","5px","right","5px"],["pRipple","","severity","primary","label","Editar","icon","pi pi-pencil",1,"mr-2",3,"text","routerLink"],[1,"text-lg"],[1,"grid","text-lg"],[1,"col-6"],[3,"value","tableStyle","paginator","rows","rowsPerPageOptions","globalFilterFields","alwaysShowPaginator"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"flex","align-items-center","justify-content-between","flex-wrap"],[1,"flex","gap-4","flex-wrap"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Buscar...",3,"input"],["pSortableColumn","nombre"],["field","nombre"],["pSortableColumn","tipo"],["field","tipo"],["pSortableColumn","cantidad"],["field","cantidad"],["pSortableColumn","cantidadDisponible"],["field","cantidadDisponible"],[3,"ngClass"],[1,"text-center","py-4"],[3,"value","tableStyle","paginator","rows","globalFilterFields","alwaysShowPaginator"],["pSortableColumn","fecha"],["field","fecha"],["pSortableColumn","codigo"],["field","codigo"],["pSortableColumn","estado"],["field","estado"],["pSortableColumn","fecha-mod"],["field","fecha-mod"],[3,"value","severity"]],template:function(e,o){e&1&&(t(0,"div",2)(1,"p-button",3),g("click",function(){return o.back()}),n(),p(2,"p-button",4),n(),y(3,Ot,21,20,"div",5)(4,qt,8,8,"div",5)),e&2&&(a(2),d("routerLink",q(3,Pe,o.Routes.ELABORACION_NEW)),a(),d("ngIf",!!o.receta),a(),d("ngIf",!!o.receta))},dependencies:[Re,X,se,_e,N,ge,he,R,at,k,Ae,ze]});let r=s;return r})();var ti=["materiaPrimaDropdown"],ii=["insumosDropdown"],ni=()=>({maxWidth:"1200px"}),ri=()=>({width:"100%"}),bt=()=>({height:"2.5rem"});function oi(r,s){if(r&1&&(t(0,"div",27),m(1),t(2,"div"),p(3,"i",28),n()()),r&2){let l=s.$implicit;a(),E(" ",l.nombre," ")}}function ai(r,s){if(r&1){let l=w();t(0,"div",29)(1,"span")(2,"b"),m(3),n()(),t(4,"div",30)(5,"p-inputGroup",31),p(6,"p-inputNumber",32),t(7,"p-inputGroupAddon"),m(8),n()(),t(9,"p-button",33),g("onClick",function(){let e=S(l).$implicit,o=_();return I(o.onDeleteMateriaPrima(e.id))}),n()()()}if(r&2){let l=s.$implicit,i=s.index;a(3),b(l.nombre),a(2),O(h(8,bt)),a(),d("maxFractionDigits",2)("formControlName",i),a(2),b(l.unidadMedida),a(),d("rounded",!0)("text",!0)}}function mi(r,s){if(r&1&&(t(0,"div",27),m(1),t(2,"div"),p(3,"i",28),n()()),r&2){let l=s.$implicit;a(),E(" ",l.nombre," ")}}function li(r,s){if(r&1){let l=w();t(0,"div",29)(1,"span")(2,"b"),m(3),n()(),t(4,"div",30)(5,"p-inputGroup",31),p(6,"p-inputNumber",32),t(7,"p-inputGroupAddon"),m(8),n()(),t(9,"p-button",33),g("onClick",function(){let e=S(l).$implicit,o=_();return I(o.onDeleteInsumo(e.id))}),n()()()}if(r&2){let l=s.$implicit,i=s.index;a(3),b(l.nombre),a(2),O(h(8,bt)),a(),d("maxFractionDigits",2)("formControlName",i),a(2),b(l.unidadMedida),a(),d("rounded",!0)("text",!0)}}function ht(r){return r.value>0?null:{greaterThanZero:!0}}var xt=(()=>{let s=class s{constructor(i,e,o,c,x){this.recetasService=i,this.materiaPrimaService=e,this.insumosService=o,this.router=c,this.toastr=x,this.loading=!1,this.allMateriasPrimas=[],this.allInsumos=[],this.selectedMateriasPrimas=[],this.selectedInsumos=[],this.form=new ne({nombre:new M("",[P.required,P.maxLength(256)]),descripcion:new M("",P.maxLength(256)),materiasPrimas:new W([],P.required),insumos:new W([],P.required)})}ngOnInit(){this.materiaPrimaService.get().subscribe(i=>this.allMateriasPrimas=i),this.insumosService.get().subscribe(i=>this.allInsumos=i)}onSubmit(){if(this.form.markAllAsTouched(),!this.form.valid)return;let i=this.form.getRawValue(),e=this.selectedInsumos.map((u,D)=>({insumoId:u.id,materiaPrimaId:null,cantidad:i.insumos[D]})),o=this.selectedMateriasPrimas.map((u,D)=>({materiaPrimaId:u.id,insumoId:null,cantidad:i.materiasPrimas[D]})),c=[...e,...o],x={nombre:i.nombre,descripcion:i.descripcion,ingredientes:c};this.loading=!0,this.recetasService.create(x).subscribe(u=>{this.toastr.success("Se ha agregado la receta"),this.router.navigate(["/"+f.Receta,f.Query])})}get filteredInsumos(){let i=this.selectedInsumos.map(e=>e.id);return this.allInsumos.filter(e=>!i.includes(e.id))}get filteredMateriasPrimas(){let i=this.selectedMateriasPrimas.map(e=>e.id);return this.allMateriasPrimas.filter(e=>!i.includes(e.id))}getMateriasPrimasFormArr(){return this.form.get("materiasPrimas")}onSelectMateriaPrima(i){let e=i.value;e&&(this.selectedMateriasPrimas.find(o=>o.id==e.id)||(this.selectedMateriasPrimas.push({id:e.id,nombre:e.nombre,cantidad:0,unidadMedida:e.unidadMedida}),this.getMateriasPrimasFormArr().push(new M("",ht))),this.materiaPrimaDropdown.clear())}onDeleteMateriaPrima(i){let e=this.selectedMateriasPrimas.findIndex(o=>o.id==i);e>-1&&(this.selectedMateriasPrimas.splice(e,1),this.getMateriasPrimasFormArr().removeAt(e))}getInsumosArr(){return this.form.get("insumos")}onSelectInsumo(i){let e=i.value;e&&(this.selectedInsumos.find(o=>o.id==e.id)||(this.selectedInsumos.push({id:e.id,nombre:e.nombre,cantidad:0,unidadMedida:e.unidadMedida}),this.getInsumosArr().push(new M("",ht))),this.insumosDropdown.clear())}onDeleteInsumo(i){let e=this.selectedInsumos.findIndex(o=>o.id==i);e>-1&&(this.selectedInsumos.splice(e,1),this.getInsumosArr().removeAt(e))}cancel(){this.router.navigate(["/"+f.Receta,f.Query])}};s.\u0275fac=function(e){return new(e||s)(v(C),v(j),v(G),v(A),v(V))},s.\u0275cmp=F({type:s,selectors:[["app-new"]],viewQuery:function(e,o){if(e&1&&($(ti,5),$(ii,5)),e&2){let c;Q(c=B())&&(o.materiaPrimaDropdown=c.first),Q(c=B())&&(o.insumosDropdown=c.first)}},features:[T([C,j,G])],decls:51,vars:22,consts:[["materiaPrimaDropdown",""],["insumosDropdown",""],["pRipple","","label","Volver","icon","pi pi-arrow-left","styleClass","mb-2","severity","secondary",3,"click"],[1,"card",3,"ngStyle"],[1,"mb-5","m-2"],[1,"p-fluid","p-formgrid","grid",3,"ngSubmit","formGroup"],[1,"field","col-12","md:col-12"],["htmlFor","nombre"],[1,"text-danger"],["pInputText","","id","firstname2","type","text","placeholder","Nombre","formControlName","nombre","appCustomInputError","",3,"errors"],["customLabel","",3,"valueForm","errors"],["htmlFor","descripcion"],["pInputText","","id","descripcion","type","text","placeholder","Descripcion","formControlName","descripcion","appCustomInputError","",3,"errors"],["styleClass","my-0 w-full",3,"ngStyle"],[1,"my-4","field","col-12","md:col-12"],[1,"text-500"],[1,"grid","w-full","field","col-12"],[1,"col"],["htmlFor","familiaPrimaId",1,"mr-3"],["placeholder","Selecciona una materia prima","optionLabel","nombre","filterBy","nombre",3,"onChange","options","autoDisplayFirst","filter","showClear"],["pTemplate","item"],["formArrayName","materiasPrimas",1,"flex","flex-column","gap-1","mt-2"],["class","shadow-1 px-2 pl-2 pr-1 flex justify-content-between align-items-center border-round-md bg-item",4,"ngFor","ngForOf"],["placeholder","Selecciona un insumos","optionLabel","nombre","filterBy","nombre",3,"onChange","options","autoDisplayFirst","filter","showClear"],["formArrayName","insumos",1,"flex","flex-column","gap-1","mt-2"],[1,"ml-auto","mt-2"],["label","Guardar","size","large","type","submit",3,"disabled"],[1,"flex","align-items-center","justify-content-between","gap-2"],[1,"fa-solid","fa-plus","text-lg","opacity-50"],[1,"shadow-1","px-2","pl-2","pr-1","flex","justify-content-between","align-items-center","border-round-md","bg-item"],[1,"flex","gap-2","align-items-center"],[1,"w-10rem"],["placeholder","Cantidad","size","2",3,"maxFractionDigits","formControlName"],["pRipple","","icon","pi pi-trash","severity","secondary",3,"onClick","rounded","text"]],template:function(e,o){if(e&1){let c=w();t(0,"p-button",2),g("click",function(){return S(c),I(o.cancel())}),n(),t(1,"div",3)(2,"h5",4),m(3,"Agregar receta"),n(),t(4,"form",5),g("ngSubmit",function(){return S(c),I(o.onSubmit())}),t(5,"div",6)(6,"h5"),m(7,"Detalles"),n(),t(8,"label",7),m(9,"Nombre "),t(10,"span",8),m(11,"*"),n()(),p(12,"input",9)(13,"span",10),n(),t(14,"div",6)(15,"label",11),m(16,"Descripci\xF3n"),n(),p(17,"input",12)(18,"span",10),n(),p(19,"p-divider",13),t(20,"div",14)(21,"h5"),m(22,"Ingredientes "),t(23,"span",8),m(24,"*"),n()(),t(25,"p",15),m(26," Los ingredientes deben estar especificados para la elaboraci\xF3n de "),t(27,"b"),m(28,"una unidad"),n(),m(29," del producto final. "),p(30,"br"),m(31," Debes incluir al menos un ingrediente de cada tipo: materia prima y receta. "),n()(),t(32,"div",16)(33,"div",17)(34,"label",18),m(35,"Materias Primas"),n(),t(36,"p-dropdown",19,0),g("onChange",function(u){return S(c),I(o.onSelectMateriaPrima(u))}),y(38,oi,4,1,"ng-template",20),n(),t(39,"div",21),y(40,ai,10,9,"div",22),n()(),t(41,"div",17)(42,"label",18),m(43,"Insumos"),n(),t(44,"p-dropdown",23,1),g("onChange",function(u){return S(c),I(o.onSelectInsumo(u))}),y(46,mi,4,1,"ng-template",20),n(),t(47,"div",24),y(48,li,10,9,"div",22),n()()(),t(49,"span",25),p(50,"p-button",26),n()()()}if(e&2){let c,x,u,D,De,Fe;a(),d("ngStyle",h(20,ni)),a(3),d("formGroup",o.form),a(8),d("errors",(c=o.form.get("nombre"))==null?null:c.errors),a(),d("valueForm",(x=o.form.get("nombre"))==null?null:x.value)("errors",(u=o.form.get("nombre"))==null?null:u.errors),a(4),d("errors",(D=o.form.get("descripcion"))==null?null:D.errors),a(),d("valueForm",(De=o.form.get("descripcion"))==null?null:De.value)("errors",(Fe=o.form.get("descripcion"))==null?null:Fe.errors),a(),d("ngStyle",h(21,ri)),a(17),d("options",o.filteredMateriasPrimas)("autoDisplayFirst",!1)("filter",!0)("showClear",!0),a(4),d("ngForOf",o.selectedMateriasPrimas),a(4),d("options",o.filteredInsumos)("autoDisplayFirst",!1)("filter",!0)("showClear",!0),a(4),d("ngForOf",o.selectedInsumos),a(2),d("disabled",o.form.invalid)}},dependencies:[K,Y,N,R,k,fe,re,ee,te,ie,oe,me,ae,de,pe,be,ve,ce,ue]});let r=s;return r})();var si=["materiaPrimaDropdown"],di=["insumosDropdown"],pi=()=>({maxWidth:"1000px"}),ci=()=>({width:"100%"}),St=()=>({height:"2.5rem"});function ui(r,s){if(r&1&&(t(0,"div",29),m(1),t(2,"div"),p(3,"i",30),n()()),r&2){let l=s.$implicit;a(),E(" ",l.nombre," ")}}function fi(r,s){if(r&1){let l=w();t(0,"div",31)(1,"span")(2,"b"),m(3),n()(),t(4,"div",32)(5,"p-inputGroup",33),p(6,"p-inputNumber",34),t(7,"p-inputGroupAddon"),m(8),n()(),t(9,"p-button",35),g("onClick",function(){let e=S(l).$implicit,o=_(2);return I(o.onDeleteMateriaPrima(e.materiaPrimaId))}),n()()()}if(r&2){let l=s.$implicit,i=s.index;a(3),b(l.nombre),a(2),O(h(8,St)),a(),d("maxFractionDigits",2)("formControlName",i),a(2),b(l.unidadMedida),a(),d("rounded",!0)("text",!0)}}function vi(r,s){if(r&1&&(t(0,"div",29),m(1),t(2,"div"),p(3,"i",30),n()()),r&2){let l=s.$implicit;a(),E(" ",l.nombre," ")}}function _i(r,s){if(r&1){let l=w();t(0,"div",31)(1,"span")(2,"b"),m(3),n()(),t(4,"div",32)(5,"p-inputGroup",33),p(6,"p-inputNumber",34),t(7,"p-inputGroupAddon"),m(8),n()(),t(9,"p-button",35),g("onClick",function(){let e=S(l).$implicit,o=_(2);return I(o.onDeleteInsumo(e.insumoId))}),n()()()}if(r&2){let l=s.$implicit,i=s.index;a(3),b(l.nombre),a(2),O(h(8,St)),a(),d("maxFractionDigits",2)("formControlName",i),a(2),b(l.unidadMedida),a(),d("rounded",!0)("text",!0)}}function gi(r,s){if(r&1){let l=w();t(0,"div",4)(1,"h5",5),m(2,"Editar receta"),n(),t(3,"form",6),g("ngSubmit",function(){S(l);let e=_();return I(e.onSubmit())}),t(4,"div",7)(5,"div",8)(6,"h5"),m(7,"Detalles"),n(),t(8,"label",9),m(9,"Nombre "),t(10,"span",10),m(11,"*"),n()(),p(12,"input",11)(13,"span",12),n(),t(14,"div",8)(15,"label",13),m(16,"Descripci\xF3n"),n(),p(17,"input",14)(18,"span",12),n(),p(19,"p-divider",15),t(20,"div",16)(21,"h5"),m(22,"Ingredientes "),t(23,"span",10),m(24,"*"),n()(),t(25,"p",17),m(26," Los ingredientes deben estar especificados para la elaboraci\xF3n de "),t(27,"b"),m(28,"una unidad"),n(),m(29," del producto final. "),p(30,"br"),m(31," Debes incluir al menos un ingrediente de cada tipo: materia prima y receta. "),n()(),t(32,"div",18)(33,"div",19)(34,"label",20),m(35,"Materias Primas"),n(),t(36,"p-dropdown",21,0),g("onChange",function(e){S(l);let o=_();return I(o.onSelectMateriaPrima(e))}),y(38,ui,4,1,"ng-template",22),n(),t(39,"div",23),y(40,fi,10,9,"div",24),n()(),t(41,"div",19)(42,"label",20),m(43,"Insumos"),n(),t(44,"p-dropdown",25,1),g("onChange",function(e){S(l);let o=_();return I(o.onSelectInsumo(e))}),y(46,vi,4,1,"ng-template",22),n(),t(47,"div",26),y(48,_i,10,9,"div",24),n()()(),t(49,"span",27),p(50,"p-button",28),n()()()()}if(r&2){let l,i,e,o,c,x,u=_();O(h(21,pi)),a(3),d("formGroup",u.form),a(9),d("errors",(l=u.form.get("nombre"))==null?null:l.errors),a(),d("valueForm",(i=u.form.get("nombre"))==null?null:i.value)("errors",(e=u.form.get("nombre"))==null?null:e.errors),a(4),d("errors",(o=u.form.get("descripcion"))==null?null:o.errors),a(),d("valueForm",(c=u.form.get("descripcion"))==null?null:c.value)("errors",(x=u.form.get("descripcion"))==null?null:x.errors),a(),d("ngStyle",h(22,ci)),a(17),d("options",u.filteredMateriasPrimas)("autoDisplayFirst",!1)("filter",!0)("showClear",!0),a(4),d("ngForOf",u.selectedMateriasPrimas),a(4),d("options",u.filteredInsumos)("autoDisplayFirst",!1)("filter",!0)("showClear",!0),a(4),d("ngForOf",u.selectedInsumos),a(2),d("disabled",u.form.invalid)}}function Se(r){return r.value>0?null:{greaterThanZero:!0}}var It=(()=>{let s=class s{constructor(i,e,o,c,x,u){this.recetasService=i,this.materiaPrimaService=e,this.insumosService=o,this.router=c,this.toastr=x,this.activatedRoute=u,this.loading=!1,this.allMateriasPrimas=[],this.allInsumos=[],this.selectedMateriasPrimas=[],this.selectedInsumos=[],this.id=Number(this.activatedRoute.snapshot.paramMap.get("id"))}ngOnInit(){this.recetasService.detail(this.id).subscribe(i=>{this.receta=i,this.selectedInsumos=i.ingredientes.filter(e=>e.insumo!=null).map(e=>({id:e.id,nombre:e.insumo.nombre,insumoId:e.insumo.id,unidadMedida:e.insumo.unidadMedida,cantidad:e.cantidad})),this.selectedMateriasPrimas=i.ingredientes.filter(e=>e.materiaPrima!=null).map(e=>({id:e.id,nombre:e.materiaPrima.nombre,materiaPrimaId:e.materiaPrima.id,unidadMedida:e.materiaPrima.unidadMedida,cantidad:e.cantidad})),this.form=new ne({nombre:new M(i.nombre,P.required),descripcion:new M(i.descripcion,P.maxLength(256)),insumos:new W(this.selectedInsumos.map(e=>new M(e.cantidad,Se)),P.required),materiasPrimas:new W(this.selectedMateriasPrimas.map(e=>new M(e.cantidad,Se)),P.required)})}),this.materiaPrimaService.get().subscribe(i=>this.allMateriasPrimas=i),this.insumosService.get().subscribe(i=>this.allInsumos=i)}onSubmit(){if(!this.form.valid)return;let i=this.form.getRawValue(),e=this.selectedInsumos.map((u,D)=>({insumoId:u.insumoId,materiaPrimaId:null,cantidad:i.insumos[D]})),o=this.selectedMateriasPrimas.map((u,D)=>({materiaPrimaId:u.materiaPrimaId,insumoId:null,cantidad:i.materiasPrimas[D]})),c=[...e,...o],x={nombre:i.nombre,descripcion:i.descripcion,ingredientes:c};this.loading=!0,this.recetasService.edit(this.id,x).subscribe(u=>{this.toastr.success("Se han guardado los cambios"),this.router.navigate(["/"+f.Receta,f.Detail,this.receta.id])})}get filteredInsumos(){let i=this.selectedInsumos.map(e=>e.insumoId);return this.allInsumos.filter(e=>!i.includes(e.id))}get filteredMateriasPrimas(){let i=this.selectedMateriasPrimas.map(e=>e.materiaPrimaId);return this.allMateriasPrimas.filter(e=>!i.includes(e.id))}getMateriasPrimasFormArr(){return this.form.get("materiasPrimas")}onSelectMateriaPrima(i){let e=i.value;e&&(this.selectedMateriasPrimas.find(o=>o.id==e.materiaPrimaId)||(this.selectedMateriasPrimas.push({id:e.id,materiaPrimaId:e.id,nombre:e.nombre,cantidad:0,unidadMedida:e.unidadMedida}),this.getMateriasPrimasFormArr().push(new M("",Se))),this.materiaPrimaDropdown.clear())}onDeleteMateriaPrima(i){let e=this.selectedMateriasPrimas.findIndex(o=>o.materiaPrimaId==i);e>-1&&(this.selectedMateriasPrimas.splice(e,1),this.getMateriasPrimasFormArr().removeAt(e))}getInsumosArr(){return this.form.get("insumos")}onSelectInsumo(i){let e=i.value;e&&(this.selectedInsumos.find(o=>o.insumoId==e.id)||(this.selectedInsumos.push({insumoId:e.id,nombre:e.nombre,cantidad:0,unidadMedida:e.unidadMedida}),this.getInsumosArr().push(new M("",Se))),this.insumosDropdown.clear())}onDeleteInsumo(i){let e=this.selectedInsumos.findIndex(o=>o.insumoId==i);e>-1&&(this.selectedInsumos.splice(e,1),this.getInsumosArr().removeAt(e))}cancel(){this.router.navigate(["/"+f.Receta,f.Query])}};s.\u0275fac=function(e){return new(e||s)(v(C),v(j),v(G),v(A),v(V),v(le))},s.\u0275cmp=F({type:s,selectors:[["receta-edit"]],viewQuery:function(e,o){if(e&1&&($(si,5),$(di,5)),e&2){let c;Q(c=B())&&(o.materiaPrimaDropdown=c.first),Q(c=B())&&(o.insumosDropdown=c.first)}},features:[T([C,j,G])],decls:2,vars:1,consts:[["materiaPrimaDropdown",""],["insumosDropdown",""],["pRipple","","label","Volver","icon","pi pi-arrow-left","styleClass","mb-2","severity","secondary",3,"click"],["class","card",3,"style",4,"ngIf"],[1,"card"],[1,"mb-5","m-2"],[3,"ngSubmit","formGroup"],[1,"p-fluid","p-formgrid","grid"],[1,"field","col-12"],["htmlFor","nombre"],[1,"text-danger"],["pInputText","","id","firstname2","type","text","placeholder","Nombre","formControlName","nombre","appCustomInputError","",3,"errors"],["customLabel","",3,"valueForm","errors"],["htmlFor","descripcion"],["pInputText","","id","descripcion","type","text","placeholder","Descripcion","formControlName","descripcion","appCustomInputError","",3,"errors"],["styleClass","my-0 w-full",3,"ngStyle"],[1,"my-4","field","col-12"],[1,"text-500"],[1,"grid","field","col-12"],[1,"col"],["htmlFor","familiaPrimaId",1,"mr-3"],["placeholder","Selecciona una materia prima","optionLabel","nombre","filterBy","nombre",3,"onChange","options","autoDisplayFirst","filter","showClear"],["pTemplate","item"],["formArrayName","materiasPrimas",1,"flex","flex-column","gap-1","mt-2"],["class","shadow-1 px-2 pl-2 pr-1 flex justify-content-between align-items-center border-round-md bg-item",4,"ngFor","ngForOf"],["placeholder","Selecciona un insumos","optionLabel","nombre","filterBy","nombre",3,"onChange","options","autoDisplayFirst","filter","showClear"],["formArrayName","insumos",1,"flex","flex-column","gap-1","mt-2"],[1,"ml-auto","mt-2"],["label","Guardar","size","large","type","submit",3,"disabled"],[1,"flex","align-items-center","justify-content-between","gap-2"],[1,"fa-solid","fa-plus","text-lg","opacity-50"],[1,"shadow-1","px-2","pl-2","pr-1","flex","justify-content-between","align-items-center","border-round-md","bg-item"],[1,"flex","gap-2","align-items-center"],[1,"w-10rem"],["placeholder","Cantidad","size","2",3,"maxFractionDigits","formControlName"],["pRipple","","icon","pi pi-trash","severity","secondary",3,"onClick","rounded","text"]],template:function(e,o){e&1&&(t(0,"p-button",2),g("click",function(){return o.cancel()}),n(),y(1,gi,51,23,"div",3)),e&2&&(a(),d("ngIf",!!o.form))},dependencies:[K,X,Y,N,R,k,fe,re,ee,te,ie,oe,me,ae,de,pe,be,ve,ce,ue],encapsulation:2});let r=s;return r})();var hi=[{path:"",redirectTo:"query",pathMatch:"full"},{path:"query",component:ft,title:"Listado de Recetas"},{path:"new",component:xt,title:"Agregar Receta"},{path:"detail/:id",component:gt,title:"Detalle de Receta"},{path:"edit/:id",component:It,title:"Editar Receta"}],xn=(()=>{let s=class s{};s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=Ne({type:s}),s.\u0275inj=Te({imports:[Ve,Qe.forChild(hi),it,Oe,We,ot,mt,Ue,rt,Ke,He,Je,st,lt,nt,et,Le,$e,Ze,pt,dt,ct,tt,Xe,Ye]});let r=s;return r})();export{xn as RecetasModule};
